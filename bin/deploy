#!/usr/bin/env bash
set -e

export DAPP_NO_SAVE=1
#export ETH_GAS=4000000
export ETH_KEYSTORE=/home/aftnix/.ethereum/keystore
export FOUNDERS_KEY=0xc8562111d28e0735556ef4253b90b486ff410719
export ETH_FROM=0xc8562111d28e0735556ef4253b90b486ff410719
token=$(set -x; dapp create DSToken \
  $(seth --to-bytes32 $(seth --from-ascii EKK))
)

sale=$(set -x; dapp create EKKDist 50 \
   $(seth --to-uint256 $(seth --to-wei 1000000000 eth)) \
   $(date +%s -d '1 second') \
   $(date +%s -d '1 minute') \
   $(seth --to-uint256 $(seth --to-wei 100000000 eth)) \
   $FOUNDERS_KEY
 )

 (set -x; seth send "$token" "setOwner(address)" "$sale")
 (set -x; seth send "$sale" "initialize(address)" "$token")

echo "token=$token"
echo "sale=$sale"
