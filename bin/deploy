#!/usr/bin/env bash
set -e

export DAPP_NO_SAVE=1
#export ETH_GAS=4000000
export ETH_KEYSTORE=/home/aftnix/.ethereum/keystore
export FOUNDERS_KEY=0x276aead77fc6e0e334060135b67be7e36bf3e1d8
export ETH_FROM=0x59e595f0fe941245d06e93927ba4d3f803757442
token=$(set -x; dapp create DSToken \
  $(seth --to-bytes32 $(seth --from-ascii EKK))
)

sale=$(set -x; dapp create EKKDist 7 \
   $(seth --to-uint256 $(seth --to-wei 1000000000 eth)) \
   $(date +%s -d '1 second') \
   $(date +%s -d '1 minute') \
   $(seth --to-uint256 $(seth --to-wei 100000000 eth)) \
   $FOUNDERS_KEY
 )

 (set -x; seth send "$token" "setOwner(address)" "$sale")
 (set -x; seth send "$sale" "initialize(address)" "$token")

echo "token=$token"
echo "sale=$sale"
